<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AZ-204 (2)</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__left">
    <div class="stackedit__toc">
      
<ul>
<li>
<ul>
<li></li>
</ul>
</li>
<li><a href="#az-204-develop-event-based-solutions">AZ-204 Develop event-based solutions</a>
<ul>
<li><a href="#explore-azure-event-grid">Explore Azure Event Grid</a></li>
<li><a href="#retry-policy">Retry policy</a></li>
<li><a href="#output-batching">Output batching</a></li>
<li><a href="#delayed-delivery">Delayed delivery</a></li>
<li><a href="#dead-letter-events">Dead-letter events</a></li>
<li><a href="#custom-delivery-properties">Custom delivery properties</a></li>
<li><a href="#next-unit-control-access-to-events">Next unit: Control access to events</a></li>
<li><a href="#control-access-to-events---training--microsoft-docs.md">Control access to events - Training  Microsoft Docs.md</a></li>
<li><a href="#built-in-roles">Built-in roles</a></li>
<li><a href="#permissions-for-event-subscriptions">Permissions for event subscriptions</a></li>
<li><a href="#next-unit-receive-events-by-using-webhooks">Next unit: Receive events by using webhooks</a></li>
<li><a href="#receive-events-by-using-webhooks---training--microsoft-docs.md">Receive events by using webhooks - Training  Microsoft Docs.md</a></li>
<li><a href="#endpoint-validation-with-event-grid-events">Endpoint validation with Event Grid events</a></li>
<li><a href="#filter-events---training--microsoft-docs.md">Filter events - Training  Microsoft Docs.md</a></li>
<li><a href="#event-type-filtering">Event type filtering</a></li>
<li><a href="#subject-filtering">Subject filtering</a></li>
<li><a href="#advanced-filtering">Advanced filtering</a></li>
<li><a href="#next-unit-exercise-route-custom-events-to-web-endpoint-by-using-azure-cli">Next unit: Exercise: Route custom events to web endpoint by using Azure CLI</a></li>
<li><a href="#exercise-route-custom-events-to-web-endpoint-by-using-azure-cli---training--microsoft-docs.md">Exercise Route custom events to web endpoint by using Azure CLI - Training  Microsoft Docs.md</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#create-a-resource-group">Create a resource group</a></li>
<li><a href="#enable-an-event-grid-resource-provider">Enable an Event Grid resource provider</a></li>
<li><a href="#create-a-custom-topic">Create a custom topic</a></li>
<li><a href="#create-a-message-endpoint">Create a message endpoint</a></li>
<li><a href="#subscribe-to-a-custom-topic">Subscribe to a custom topic</a></li>
<li><a href="#send-an-event-to-your-custom-topic">Send an event to your custom topic</a></li>
<li><a href="#clean-up-resources">Clean up resources</a></li>
<li><a href="#explore-azure-event-hubs---training--microsoft-docs.md">Explore Azure Event Hubs - Training  Microsoft Docs.md</a></li>
<li><a href="#learning-objectives">Learning objectives</a></li>
<li><a href="#prerequisites-1">Prerequisites</a></li>
<li><a href="#introduction---training--microsoft-docs9.md">Introduction - Training  Microsoft Docs(9).md</a></li>
<li><a href="#next-unit-discover-azure-event-hubs">Next unit: Discover Azure Event Hubs</a></li>
<li><a href="#discover-azure-event-hubs---training--microsoft-docs.md">Discover Azure Event Hubs - Training  Microsoft Docs.md</a></li>
<li><a href="#key-concepts">Key concepts</a></li>
<li><a href="#next-unit-explore-event-hubs-capture">Next unit: Explore Event Hubs Capture</a></li>
<li><a href="#explore-event-hubs-capture---training--microsoft-docs.md">Explore Event Hubs Capture - Training  Microsoft Docs.md</a></li>
<li><a href="#how-event-hubs-capture-works">How Event Hubs Capture works</a></li>
<li><a href="#capture-windowing">Capture windowing</a></li>
<li><a href="#scaling-to-throughput-units">Scaling to throughput units</a></li>
<li><a href="#next-unit-scale-your-processing-application">Next unit: Scale your processing application</a></li>
<li><a href="#scale-your-processing-application---training--microsoft-docs.md">Scale your processing application - Training  Microsoft Docs.md</a></li>
<li><a href="#example-scenario">Example scenario</a></li>
<li><a href="#event-processor-or-consumer-client">Event processor or consumer client</a></li>
<li><a href="#partition-ownership-tracking">Partition ownership tracking</a></li>
<li><a href="#receive-messages">Receive messages</a></li>
<li><a href="#checkpointing">Checkpointing</a></li>
<li><a href="#thread-safety-and-processor-instances">Thread safety and processor instances</a></li>
<li><a href="#next-unit-control-access-to-events-1">Next unit: Control access to events</a></li>
<li><a href="#control-access-to-events---training--microsoft-docs1.md">Control access to events - Training  Microsoft Docs(1).md</a></li>
<li><a href="#authorize-access-with-microsoft-identity-platform">Authorize access with Microsoft Identity Platform</a></li>
<li><a href="#next-unit-perform-common-operations-with-the-event-hubs-client-library">Next unit: Perform common operations with the Event Hubs client library</a></li>
<li><a href="#perform-common-operations-with-the-event-hubs-client-library---training--microsoft-docs.md">Perform common operations with the Event Hubs client library - Training  Microsoft Docs.md</a></li>
<li><a href="#inspect-an-event-hub">Inspect an Event Hub</a></li>
<li><a href="#publish-events-to-an-event-hub">Publish events to an Event Hub</a></li>
<li><a href="#read-events-from-an-event-hub">Read events from an Event Hub</a></li>
<li><a href="#read-events-from-an-event-hub-partition">Read events from an Event Hub partition</a></li>
<li><a href="#process-events-using-an-event-processor-client">Process events using an Event Processor client</a></li>
<li><a href="#az-204-develop-message-based-solutions---training--microsoft-docs.md">AZ-204 Develop message-based solutions - Training  Microsoft Docs.md</a></li>
<li><a href="#prerequisites-2">Prerequisites</a></li>
<li><a href="#discover-azure-message-queues---training--microsoft-docs.md">Discover Azure message queues - Training  Microsoft Docs.md</a></li>
<li><a href="#introduction---training--microsoft-docs10.md">Introduction - Training  Microsoft Docs(10).md</a></li>
<li><a href="#next-unit-choose-a-message-queue-solution">Next unit: Choose a message queue solution</a></li>
<li><a href="#choose-a-message-queue-solution---training--microsoft-docs.md">Choose a message queue solution - Training  Microsoft Docs.md</a></li>
<li><a href="#consider-using-service-bus-queues">Consider using Service Bus queues</a></li>
<li><a href="#consider-using-storage-queues">Consider using Storage queues</a></li>
<li><a href="#next-unit-explore-azure-service-bus">Next unit: Explore Azure Service Bus</a></li>
<li><a href="#explore-azure-service-bus---training--microsoft-docs.md">Explore Azure Service Bus - Training  Microsoft Docs.md</a></li>
<li><a href="#service-bus-tiers">Service Bus tiers</a></li>
<li><a href="#advanced-features">Advanced features</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
  <div class="stackedit__right">
    <div class="stackedit__html">
      <h3 id="secure-apis-by-using-subscriptions">Secure APIs by using subscriptions</h3>
<p>When you publish APIs through API Management, it’s easy and common to secure access to those APIs by using subscription keys. A subscription is essentially a named container for a pair of subscription keys.</p>
<h4 id="subscriptions-and-keys">Subscriptions and Keys</h4>
<p>A subscription key is a unique auto-generated key that can be passed through in the headers of the client request or as a query string parameter.</p>
<p>The three main subscription scopes are:</p>

<table>
<thead>
<tr>
<th>Scope</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td>All APIs</td>
<td>Applies to every API accessible from the gateway</td>
</tr>
<tr>
<td>Single API</td>
<td>This scope applies to a single imported API and all of its endpoints</td>
</tr>
<tr>
<td>Product</td>
<td>A product is a collection of one or more APIs that you configure in API Management. You can assign APIs to more than one product.</td>
</tr>
</tbody>
</table><p>You can regenerate these subscription keys at any time, for example, if you suspect that a key has been shared with unauthorized users.</p>
<p><img src="https://docs.microsoft.com/en-us/training/wwl-azure/explore-api-management/media/subscription-keys.png" alt="Image showing the Subscriptions screen."><br>
Every subscription has two keys, a primary and a secondary. Having two keys makes it easier when you do need to regenerate a key.</p>
<p>Developers can obtain a key by submitting a subscription request. If you approve the request, you must send them the subscription key securely, for example, in an encrypted message.</p>
<h4 id="call-an-api-with-the-subscription-key">Call an API with the subscription key</h4>
<p>The default header name is <strong>Ocp-Apim-Subscription-Key</strong>, and the default query string is <strong>subscription-key</strong>.</p>
<p>To test out your API calls, you can use the developer portal, or command-line tools, such as <strong>curl</strong>. Here’s an example of a <code>GET</code> request using the developer portal, which shows the subscription key header:</p>
<p><img src="https://docs.microsoft.com/en-us/training/wwl-azure/explore-api-management/media/key-header-portal.png" alt="Call API from developer portal"></p>
<p>Here’s how you can pass a key in the request header using <strong>curl</strong>:</p>
<pre><code>curl --header "Ocp-Apim-Subscription-Key: &lt;key string&gt;" https://&lt;apim gateway&gt;.azure-api.net/api/path
</code></pre>
<p>Here’s an example <strong>curl</strong> command that passes a key in the URL as a query string:</p>
<pre><code>curl https://&lt;apim gateway&gt;.azure-api.net/api/path?subscription-key=&lt;key string&gt;
</code></pre>
<p>If the key is not passed in the header, or as a query string in the URL, you’ll get a <strong>401 Access Denied</strong> response from the API gateway.</p>
<h3 id="secure-apis-by-using-certificates">Secure APIs by using certificates</h3>
<p>Certificates can be used to provide Transport Layer Security (TLS) mutual authentication between the client and the API gateway.</p>
<h4 id="transport-layer-security-client-authentication">Transport Layer Security client authentication</h4>
<p>With TLS client authentication, the API Management gateway can inspect the certificate contained within the client request and check for properties like:</p>

<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Certificate Authority (CA)</strong></td>
<td>Only allow certificates signed by a particular CA</td>
</tr>
<tr>
<td><strong>Thumbprint</strong></td>
<td>Allow certificates containing a specified thumbprint</td>
</tr>
<tr>
<td><strong>Subject</strong></td>
<td>Only allow certificates with a specified subject</td>
</tr>
<tr>
<td><strong>Expiration Date</strong></td>
<td>Only allow certificates that have not expired</td>
</tr>
</tbody>
</table><p>These properties are not mutually exclusive and they can be mixed together to form your own policy requirements.</p>
<p>Client certificates are signed to ensure that they are not tampered with. There are two common ways to verify a certificate:</p>
<ul>
<li>Check who issued the certificate. If the issuer was a certificate authority that you trust, you can use the certificate.</li>
<li>If the certificate is issued by the partner, verify that it came from them.</li>
</ul>
<h4 id="accepting-client-certificates-in-the-consumption-tier">Accepting client certificates in the Consumption tier</h4>
<p>The Consumption tier in API Management is designed to conform with serverless design principals. If you build your APIs from serverless technologies, such as Azure Functions, this tier is a good fit. In the Consumption tier, you must explicitly enable the use of client certificates, which you can do on the <strong>Custom domains</strong> page. Create these policies in the inbound processing policy file within the API Management gateway:</p>
<p><img src="https://docs.microsoft.com/en-us/training/wwl-azure/explore-api-management/media/inbound-policy.png" alt="Inbound processing policy button"></p>
<h5 id="check-the-thumbprint-of-a-client-certificate">Check the thumbprint of a client certificate</h5>
<p>Every client certificate includes a thumbprint, which is a hash, calculated from other certificate properties. The thumbprint ensures that the values in the certificate have not been altered since the certificate was issued by the certificate authority. You can check the thumbprint in your policy. The following example checks the thumbprint of the certificate passed in the request:</p>
<pre><code>&lt;choose&gt;
    &lt;when condition="@(context.Request.Certificate == null || context.Request.Certificate.Thumbprint != "desired-thumbprint")" &gt;
        &lt;return-response&gt;
            &lt;set-status code="403" reason="Invalid client certificate" /&gt;
        &lt;/return-response&gt;
    &lt;/when&gt;
&lt;/choose&gt;
</code></pre>
<h5 id="check-the-thumbprint-against-certificates-uploaded-to-api-management">Check the thumbprint against certificates uploaded to API Management</h5>
<p>In the previous example, only one thumbprint would work so only one certificate would be validated. Usually, each customer or partner company would pass a different certificate with a different thumbprint. To support this scenario, obtain the certificates from your partners and use the <strong>Client certificates</strong> page in the Azure portal to upload them to the API Management resource. Then add this code to your policy:</p>
<pre><code>&lt;choose&gt;
    &lt;when condition="@(context.Request.Certificate == null || !context.Request.Certificate.Verify()  || !context.Deployment.Certificates.Any(c =&gt; c.Value.Thumbprint == context.Request.Certificate.Thumbprint))" &gt;
        &lt;return-response&gt;
            &lt;set-status code="403" reason="Invalid client certificate" /&gt;
        &lt;/return-response&gt;
    &lt;/when&gt;
&lt;/choose&gt;
</code></pre>
<h5 id="check-the-issuer-and-subject-of-a-client-certificate">Check the issuer and subject of a client certificate</h5>
<pre><code>&lt;choose&gt;
    &lt;when condition="@(context.Request.Certificate == null || context.Request.Certificate.Issuer != "trusted-issuer" || context.Request.Certificate.SubjectName.Name != "expected-subject-name")" &gt;
        &lt;return-response&gt;
            &lt;set-status code="403" reason="Invalid client certificate" /&gt;
        &lt;/return-response&gt;
    &lt;/when&gt;
&lt;/choose&gt;
</code></pre>
<h1 id="az-204-develop-event-based-solutions">AZ-204 Develop event-based solutions</h1>
<h2 id="explore-azure-event-grid">Explore Azure Event Grid</h2>
<h3 id="explore-azure-event-grid-1">Explore Azure Event Grid</h3>
<p>Azure Event Grid is an eventing backplane that enables event-driven, reactive programming. It uses the publish-subscribe model. Publishers emit events, but have no expectation about how the events are handled. Subscribers decide on which events they want to handle. Event Grid efficiently and reliably routes events from Azure and non-Azure resources, and distributes the events to registered subscriber endpoints.</p>
<p>Event Grid allows you to easily build applications with event-based architectures. Event Grid has built-in support for events coming from Azure services, like storage blobs and resource groups. Event Grid also has support for your own events, using custom topics.</p>
<p>You can use filters to route specific events to different endpoints, multicast to multiple endpoints, and make sure your events are reliably delivered.</p>
<p><img src="https://docs.microsoft.com/en-us/training/wwl-azure/azure-event-grid/media/functional-model.png" alt="Image showing the Event Grid model of sources and handlers"></p>
<h4 id="concepts-in-azure-event-grid">Concepts in Azure Event Grid</h4>
<ul>
<li><strong>Events</strong> - What happened.</li>
<li><strong>Event sources</strong> - Where the event took place.</li>
<li><strong>Topics</strong> - The endpoint where publishers send events.</li>
<li><strong>Event subscriptions</strong> - The endpoint or built-in mechanism to route events, sometimes to more than one handler.</li>
<li><strong>Event handlers</strong> - The app or service reacting to the event.</li>
</ul>
<h5 id="events">Events</h5>
<p>An event is the smallest amount of information that fully describes something that happened in the system. Every event has common information like: source of the event, time the event took place, and unique identifier. Every event also has specific information that is only relevant to the specific type of event.</p>
<p>An event of size up to 64 KB is covered by General Availability (GA) Service Level Agreement (SLA).</p>
<h5 id="event-sources">Event sources</h5>
<p>An event source is where the event happens. Each event source is related to one or more event types. For example, Azure Storage is the event source for blob created events.</p>
<h5 id="topics">Topics</h5>
<p>The event grid topic provides an endpoint where the source sends events. The publisher creates the event grid topic, and decides whether an event source needs one topic or more than one topic. A topic is used for a collection of related events. To respond to certain types of events, subscribers decide which topics to subscribe to.</p>
<p><strong>System topics</strong> are built-in topics provided by Azure services. You don’t see system topics in your Azure subscription because the publisher owns the topics, but you can subscribe to them.</p>
<p><strong>Custom topics</strong> are application and third-party topics.</p>
<h5 id="event-subscriptions">Event subscriptions</h5>
<p>A subscription tells Event Grid which events on a topic you’re interested in receiving. When creating the subscription, you provide an endpoint for handling the event. You can filter the events that are sent to the endpoint. Set an expiration for event subscriptions that are only needed for a limited time .</p>
<h5 id="event-handlers">Event handlers</h5>
<p>From an Event Grid perspective, an event handler is the place where the event is sent. The handler takes some further action to process the event. Event Grid supports several handler types.</p>
<h3 id="discover-event-schemas">Discover event schemas</h3>
<p>Events consist of a set of four required string properties. The properties are common to all events from any publisher.</p>
<p>The data object (=payload) has properties that are specific to each publisher.</p>
<p>Event sources send events to Azure Event Grid in an array, which can have several event objects. When posting events to an event grid topic, the array can have a total size of up to 1 MB. Each event in the array is limited to 1 MB. If an event or the array is greater than the size limits, you receive the response <code>413 Payload Too Large</code>. Operations are charged in 64 Kb increments though.</p>
<p>Event Grid sends the events to subscribers in an array that has a single event.</p>
<h4 id="event-schema">Event schema</h4>
<p>The following example shows the properties that are used by all event publishers:</p>
<pre><code>[
  {
    "topic": string,
    "subject": string,
    "id": string,
    "eventType": string,
    "eventTime": string,
    "data":{
      object-unique-to-each-publisher
    },
    "dataVersion": string,
    "metadataVersion": string
  }
]
</code></pre>
<h4 id="event-properties">Event properties</h4>
<p>All events have the same following top-level data:</p>

<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Required</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>topic</td>
<td>string</td>
<td>No. If not included, Event Grid will stamp onto the event.</td>
<td>Full resource path to the event source. This field isn’t writeable. Event Grid provides this value.</td>
</tr>
<tr>
<td>subject</td>
<td>string</td>
<td>Yes</td>
<td>Publisher-defined path to the event subject.</td>
</tr>
<tr>
<td>eventType</td>
<td>string</td>
<td>Yes</td>
<td>One of the registered event types for this event source.</td>
</tr>
<tr>
<td>eventTime</td>
<td>string</td>
<td>Yes</td>
<td>The time the event is generated based on the provider’s UTC time.</td>
</tr>
<tr>
<td>id</td>
<td>string</td>
<td>Yes</td>
<td>Unique identifier for the event.</td>
</tr>
<tr>
<td>data</td>
<td>object</td>
<td>No</td>
<td>Event data specific to the resource provider.</td>
</tr>
<tr>
<td>dataVersion</td>
<td>string</td>
<td>No. If not included it will be stamped with an empty value.</td>
<td>The schema version of the data object. The publisher defines the schema version.</td>
</tr>
<tr>
<td>metadataVersion</td>
<td>string</td>
<td>No. If not included, Event Grid will stamp onto the event.</td>
<td>The schema version of the event metadata. Event Grid defines the schema of the top-level properties. Event Grid provides this value.</td>
</tr>
</tbody>
</table><p>For custom topics, the event publisher determines the data object. The top-level data should have the same fields as standard resource-defined events.</p>
<p>When publishing events to custom topics, create subjects for your events that make it easy for subscribers to know whether they’re interested in the event. Subscribers use the subject to filter and route events. Consider providing the path for where the event happened, so subscribers can filter by segments of that path. The path enables subscribers to narrowly or broadly filter events. For example, if you provide a three segment path like <code>/A/B/C</code> in the subject, subscribers can filter by the first segment <code>/A</code> to get a broad set of events. Other subscribers can filter by <code>/A/B</code> to get a narrower set of events.</p>
<p>Sometimes your subject needs more detail about what happened. For example, the <strong>Storage Accounts</strong> publisher provides the subject <code>/blobServices/default/containers/&lt;container-name&gt;/blobs/&lt;file&gt;</code> when a file is added to a container. A subscriber could filter or route by the suffix <code>.txt</code> to only work with text files.</p>
<h4 id="cloudevents-v1.0-schema">CloudEvents v1.0 schema</h4>
<p>In addition to its default event schema, Azure Event Grid natively supports events in the JSON implementation of CloudEvents v1.0 and HTTP protocol binding. CloudEvents is an open specification for describing event data. With a common schema, you can more easily integrate work across platforms.</p>
<p>Here is an example of an Azure Blob Storage event in CloudEvents format:</p>
<pre><code>{
    "specversion": "1.0",
    "type": "Microsoft.Storage.BlobCreated",  
    "source": "/subscriptions/{subscription-id}/resourceGroups/{resource-group}/providers/Microsoft.Storage/storageAccounts/{storage-account}",
    "id": "9aeb0fdf-c01e-0131-0922-9eb54906e209",
    "time": "2019-11-18T15:13:39.4589254Z",
    "subject": "blobServices/default/containers/{storage-container}/blobs/{new-file}",
    "dataschema": "#",
    "data": {
        "api": "PutBlockList",
        "clientRequestId": "4c5dd7fb-2c48-4a27-bb30-5361b5de920a",
        "requestId": "9aeb0fdf-c01e-0131-0922-9eb549000000",
        "eTag": "0x8D76C39E4407333",
        "contentType": "image/png",
        "contentLength": 30699,
        "blobType": "BlockBlob",
        "url": "https://gridtesting.blob.core.windows.net/testcontainer/{new-file}",
        "sequencer": "000000000000000000000000000099240000000000c41c18",
        "storageDiagnostics": {
            "batchId": "681fe319-3006-00a8-0022-9e7cde000000"
        }
    }
}
</code></pre>
<p>The headers values for events delivered in the CloudEvents schema and the Event Grid schema are the same except for <code>content-type</code>. For CloudEvents schema, that header value is <code>"content-type":"application/cloudevents+json; charset=utf-8"</code>. For Event Grid schema, that header value is <code>"content-type":"application/json; charset=utf-8"</code>.</p>
<h3 id="explore-event-delivery-durability">Explore event delivery durability</h3>
<p>Event Grid provides durable delivery. It tries to deliver each event at least once for each matching subscription immediately.</p>
<h4 id="retry-schedule">Retry schedule</h4>
<p>When Event Grid receives an error for an event delivery attempt, EventGrid decides whether it should retry the delivery, dead-letter the event, or drop the event based on the type of the error.</p>
<p>If the error returned by the subscribed endpoint is a configuration-related error that can’t be fixed with retries (for example, if the endpoint is deleted), EventGrid will either perform dead-lettering on the event or drop the event if dead-letter isn’t configured.</p>
<p>The following table describes the types of endpoints and errors for which retry doesn’t happen:</p>

<table>
<thead>
<tr>
<th>Endpoint Type</th>
<th>Error codes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Azure Resources</td>
<td>400 Bad Request, 413 Request Entity Too Large, 403 Forbidden</td>
</tr>
<tr>
<td>Webhook</td>
<td>400 Bad Request, 413 Request Entity Too Large, 403 Forbidden, 404 Not Found, 401 Unauthorized</td>
</tr>
</tbody>
</table><p>If the error returned by the subscribed endpoint isn’t among the above list, Event Grid waits 30 seconds for a response after delivering a message. After 30 seconds, if the endpoint hasn’t responded, the message is queued for retry. Event Grid uses an exponential backoff retry policy for event delivery.</p>
<p>If the endpoint responds within 3 minutes, Event Grid will attempt to remove the event from the retry queue on a best effort basis but duplicates may still be received. Event Grid adds a small randomization to all retry steps and may opportunistically skip certain retries if an endpoint is consistently unhealthy, down for a long period, or appears to be overwhelmed.</p>
<h2 id="retry-policy">Retry policy</h2>
<p>You can customize the retry policy when creating an event subscription by using the following two configurations. An event will be dropped if either of the limits of the retry policy is reached.</p>
<ul>
<li><strong>Maximum number of attempts</strong> - The value must be an integer between 1 and 30. The default value is 30.</li>
<li><strong>Event time-to-live (TTL)</strong> - The value must be an integer between 1 and 1440. The default value is 1440 minutes</li>
</ul>
<p>The example below shows setting the maximum number of attempts to 18 by using the Azure CLI.</p>
<pre><code>az eventgrid event-subscription create \
  -g gridResourceGroup \
  --topic-name &lt;topic_name&gt; \
  --name &lt;event_subscription_name&gt; \
  --endpoint &lt;endpoint_URL&gt; \
  --max-delivery-attempts 18
</code></pre>
<h2 id="output-batching">Output batching</h2>
<p>You can configure Event Grid to batch events for delivery for improved HTTP performance in high-throughput scenarios. Batching is turned off by default and can be turned on per-subscription via the portal, CLI, PowerShell, or SDKs.</p>
<p>Batched delivery has two settings:</p>
<ul>
<li>
<p><strong>Max events per batch</strong> - Maximum number of events Event Grid will deliver per batch. This number will never be exceeded, however fewer events may be delivered if no other events are available at the time of publish. Event Grid doesn’t delay events to create a batch if fewer events are available. Must be between 1 and 5,000.</p>
</li>
<li>
<p><strong>Preferred batch size in kilobytes</strong> - Target ceiling for batch size in kilobytes. Similar to max events, the batch size may be smaller if more events aren’t available at the time of publish. It’s possible that a batch is larger than the preferred batch size <em>if</em> a single event is larger than the preferred size. For example, if the preferred size is 4 KB and a 10-KB event is pushed to Event Grid, the 10-KB event will still be delivered in its own batch rather than being dropped.</p>
</li>
</ul>
<h2 id="delayed-delivery">Delayed delivery</h2>
<p>As an endpoint experiences delivery failures, Event Grid will begin to delay the delivery and retry of events to that endpoint. For example, if the first 10 events published to an endpoint fail, Event Grid will assume that the endpoint is experiencing issues and will delay all subsequent retries, and new deliveries, for some time - in some cases up to several hours.</p>
<p>The functional purpose of delayed delivery is to protect unhealthy endpoints and the Event Grid system. Without back-off and delay of delivery to unhealthy endpoints, Event Grid’s retry policy and volume capabilities can easily overwhelm a system.</p>
<h2 id="dead-letter-events">Dead-letter events</h2>
<p>When Event Grid can’t deliver an event within a certain time period or after trying to deliver the event a certain number of times, it can send the undelivered event to a storage account. This process is known as <strong>dead-lettering</strong>. Event Grid dead-letters an event when <strong>one of the following</strong> conditions is met.</p>
<ul>
<li>Event isn’t delivered within the <strong>time-to-live</strong> period.</li>
<li>The <strong>number of tries</strong> to deliver the event exceeds the limit.</li>
</ul>
<p>If either of the conditions is met, the event is dropped or dead-lettered. By default, Event Grid doesn’t turn on dead-lettering. To enable it, you must specify a storage account to hold undelivered events when creating the event subscription. You pull events from this storage account to resolve deliveries.</p>
<p>If Event Grid receives a 400 (Bad Request) or 413 (Request Entity Too Large) response code, it immediately schedules the event for dead-lettering. These response codes indicate delivery of the event will never succeed.</p>
<p>There is a five-minute delay between the last attempt to deliver an event and when it is delivered to the dead-letter location. This delay is intended to reduce the number of Blob storage operations. If the dead-letter location is unavailable for four hours, the event is dropped.</p>
<h2 id="custom-delivery-properties">Custom delivery properties</h2>
<p>Event subscriptions allow you to set up HTTP headers that are included in delivered events. This capability allows you to set custom headers that are required by a destination. You can set up to 10 headers when creating an event subscription. Each header value shouldn’t be greater than 4,096 (4K) bytes. You can set custom headers on the events that are delivered to the following destinations:</p>
<ul>
<li>Webhooks</li>
<li>Azure Service Bus topics and queues</li>
<li>Azure Event Hubs</li>
<li>Relay Hybrid Connections</li>
</ul>
<p>Before setting the dead-letter location, you must have a storage account with a container. You provide the endpoint for this container when creating the event subscription.</p>
<hr>
<h2 id="next-unit-control-access-to-events">Next unit: Control access to events</h2>
<p><a href="https://docs.microsoft.com/en-us/training/modules/azure-event-grid/5-authorize-access-event-grid/">Continue</a></p>
<h2 id="control-access-to-events---training--microsoft-docs.md">Control access to events - Training  Microsoft <a href="http://Docs.md">Docs.md</a></h2>
<ul>
<li>3 minutes</li>
</ul>
<p>Azure Event Grid allows you to control the level of access given to different users to do various management operations such as list event subscriptions, create new ones, and generate keys. Event Grid uses Azure role-based access control (Azure RBAC).</p>
<h2 id="built-in-roles">Built-in roles</h2>
<p>Event Grid provides the following built-in roles:</p>

<table>
<thead>
<tr>
<th>Role</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Event Grid Subscription Reader</td>
<td>Lets you read Event Grid event subscriptions.</td>
</tr>
<tr>
<td>Event Grid Subscription Contributor</td>
<td>Lets you manage Event Grid event subscription operations.</td>
</tr>
<tr>
<td>Event Grid Contributor</td>
<td>Lets you create and manage Event Grid resources.</td>
</tr>
<tr>
<td>Event Grid Data Sender</td>
<td>Lets you send events to Event Grid topics.</td>
</tr>
</tbody>
</table><p>The Event Grid Subscription Reader and Event Grid Subscription Contributor roles are for managing event subscriptions. They’re important when implementing event domains because they give users the permissions they need to subscribe to topics in your event domain. These roles are focused on event subscriptions and don’t grant access for actions such as creating topics.</p>
<p>The Event Grid Contributor role allows you to create and manage Event Grid resources.</p>
<h2 id="permissions-for-event-subscriptions">Permissions for event subscriptions</h2>
<p>If you’re using an event handler that isn’t a WebHook (such as an event hub or queue storage), you need write access to that resource. This permissions check prevents an unauthorized user from sending events to your resource.</p>
<p>You must have the <strong>Microsoft.EventGrid/EventSubscriptions/Write</strong> permission on the resource that is the event source. You need this permission because you’re writing a new subscription at the scope of the resource. The required resource differs based on whether you’re subscribing to a system topic or custom topic. Both types are described in this section.</p>

<table>
<thead>
<tr>
<th>Topic Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>System topics</td>
<td>Need permission to write a new event subscription at the scope of the resource publishing the event. The format of the resource is: <code>/subscriptions/{subscription-id}/resourceGroups/{resource-group-name}/providers/{resource-provider}/{resource-type}/{resource-name}</code></td>
</tr>
<tr>
<td>Custom topics</td>
<td>Need permission to write a new event subscription at the scope of the event grid topic. The format of the resource is: <code>/subscriptions/{subscription-id}/resourceGroups/{resource-group-name}/providers/Microsoft.EventGrid/topics/{topic-name}</code></td>
</tr>
</tbody>
</table><hr>
<h2 id="next-unit-receive-events-by-using-webhooks">Next unit: Receive events by using webhooks</h2>
<p><a href="https://docs.microsoft.com/en-us/training/modules/azure-event-grid/6-webhook-event-delivery/">Continue</a></p>
<p>Need help? See our <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-grid.control-access-to-events&amp;documentId=b1e9ad2b-ba19-896c-35f4-05706351ff95&amp;versionIndependentDocumentId=01226371-2867-cd74-6eec-eed7c37b51be&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-grid%2F5-authorize-access-event-grid.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-grid%2F5-authorize-access-event-grid&amp;author=jeffko">troubleshooting guide</a> or provide specific feedback by <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-grid.control-access-to-events&amp;documentId=b1e9ad2b-ba19-896c-35f4-05706351ff95&amp;versionIndependentDocumentId=01226371-2867-cd74-6eec-eed7c37b51be&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-grid%2F5-authorize-access-event-grid.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-grid%2F5-authorize-access-event-grid&amp;author=jeffko#report-feedback">reporting an issue</a>.</p>
<h2 id="receive-events-by-using-webhooks---training--microsoft-docs.md">Receive events by using webhooks - Training  Microsoft <a href="http://Docs.md">Docs.md</a></h2>
<ul>
<li>3 minutes</li>
</ul>
<p>Webhooks are one of the many ways to receive events from Azure Event Grid. When a new event is ready, Event Grid service POSTs an HTTP request to the configured endpoint with the event in the request body.</p>
<p>Like many other services that support webhooks, Event Grid requires you to prove ownership of your Webhook endpoint before it starts delivering events to that endpoint. This requirement prevents a malicious user from flooding your endpoint with events.</p>
<p>When you use any of the three Azure services listed below, the Azure infrastructure automatically handles this validation:</p>
<ul>
<li>Azure Logic Apps with Event Grid Connector</li>
<li>Azure Automation via webhook</li>
<li>Azure Functions with Event Grid Trigger</li>
</ul>
<h2 id="endpoint-validation-with-event-grid-events">Endpoint validation with Event Grid events</h2>
<p>If you’re using any other type of endpoint, such as an HTTP trigger based Azure function, your endpoint code needs to participate in a validation handshake with Event Grid. Event Grid supports two ways of validating the subscription.</p>
<ul>
<li>
<p><strong>Synchronous handshake</strong>: At the time of event subscription creation, Event Grid sends a subscription validation event to your endpoint. The schema of this event is similar to any other Event Grid event. The data portion of this event includes a <code>validationCode</code> property. Your application verifies that the validation request is for an expected event subscription, and returns the validation code in the response synchronously. This handshake mechanism is supported in all Event Grid versions.</p>
</li>
<li>
<p><strong>Asynchronous handshake</strong>: In certain cases, you can’t return the ValidationCode in response synchronously. For example, if you use a third-party service (like <a href="https://zapier.com/">Zapier</a> or <a href="https://ifttt.com/">IFTTT</a>), you can’t programmatically respond with the validation code.</p>
</li>
</ul>
<p>Starting with version 2018-05-01-preview, Event Grid supports a manual validation handshake. If you’re creating an event subscription with an SDK or tool that uses API version 2018-05-01-preview or later, Event Grid sends a <code>validationUrl</code> property in the data portion of the subscription validation event. To complete the handshake, find that URL in the event data and do a GET request to it. You can use either a REST client or your web browser.</p>
<p>The provided URL is valid for <strong>5 minutes</strong>. During that time, the provisioning state of the event subscription is <code>AwaitingManualAction</code>. If you don’t complete the manual validation within 5 minutes, the provisioning state is set to <code>Failed</code>. You’ll have to create the event subscription again before starting the manual validation.</p>
<p>This authentication mechanism also requires the webhook endpoint to return an HTTP status code of 200 so that it knows that the POST for the validation event was accepted before it can be put in the manual validation mode. In other words, if the endpoint returns 200 but doesn’t return back a validation response synchronously, the mode is transitioned to the manual validation mode. If there’s a GET on the validation URL within 5 minutes, the validation handshake is considered to be successful.</p>
<p>Note</p>
<p>Using self-signed certificates for validation isn’t supported. Use a signed certificate from a commercial certificate authority (CA) instead.</p>
<p>Need help? See our <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-grid.receive-events-by-using-webhooks&amp;documentId=947d0808-df8f-a2be-ba09-80f067396608&amp;versionIndependentDocumentId=18849678-164d-fa40-db8f-4925f14d2afd&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-grid%2F6-webhook-event-delivery.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-grid%2F6-webhook-event-delivery&amp;author=jeffko">troubleshooting guide</a> or provide specific feedback by <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-grid.receive-events-by-using-webhooks&amp;documentId=947d0808-df8f-a2be-ba09-80f067396608&amp;versionIndependentDocumentId=18849678-164d-fa40-db8f-4925f14d2afd&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-grid%2F6-webhook-event-delivery.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-grid%2F6-webhook-event-delivery&amp;author=jeffko#report-feedback">reporting an issue</a>.</p>
<h2 id="filter-events---training--microsoft-docs.md">Filter events - Training  Microsoft <a href="http://Docs.md">Docs.md</a></h2>
<ul>
<li>3 minutes</li>
</ul>
<p>When creating an event subscription, you have three options for filtering:</p>
<ul>
<li>Event types</li>
<li>Subject begins with or ends with</li>
<li>Advanced fields and operators</li>
</ul>
<h2 id="event-type-filtering">Event type filtering</h2>
<p>By default, all event types for the event source are sent to the endpoint. You can decide to send only certain event types to your endpoint. For example, you can get notified of updates to your resources, but not notified for other operations like deletions. In that case, filter by the <code>Microsoft.Resources.ResourceWriteSuccess</code> event type. Provide an array with the event types, or specify <code>All</code> to get all event types for the event source.</p>
<p>The JSON syntax for filtering by event type is:</p>
<pre><code>"filter": {
  "includedEventTypes": [
    "Microsoft.Resources.ResourceWriteFailure",
    "Microsoft.Resources.ResourceWriteSuccess"
  ]
}
</code></pre>
<h2 id="subject-filtering">Subject filtering</h2>
<p>For simple filtering by subject, specify a starting or ending value for the subject. For example, you can specify the subject ends with <code>.txt</code> to only get events related to uploading a text file to storage account. Or, you can filter the subject begins with <code>/blobServices/default/containers/testcontainer</code> to get all events for that container but not other containers in the storage account.</p>
<p>The JSON syntax for filtering by subject is:</p>
<pre><code>"filter": {
  "subjectBeginsWith": "/blobServices/default/containers/mycontainer/log",
  "subjectEndsWith": ".jpg"
}
</code></pre>
<h2 id="advanced-filtering">Advanced filtering</h2>
<p>To filter by values in the data fields and specify the comparison operator, use the advanced filtering option. In advanced filtering, you specify the:</p>
<ul>
<li>operator type - The type of comparison.</li>
<li>key - The field in the event data that you’re using for filtering. It can be a number, boolean, or string.</li>
<li>value or values - The value or values to compare to the key.</li>
</ul>
<p>The JSON syntax for using advanced filters is:</p>
<pre><code>"filter": {
  "advancedFilters": [
    {
      "operatorType": "NumberGreaterThanOrEquals",
      "key": "Data.Key1",
      "value": 5
    },
    {
      "operatorType": "StringContains",
      "key": "Subject",
      "values": ["container1", "container2"]
    }
  ]
}
</code></pre>
<hr>
<h2 id="next-unit-exercise-route-custom-events-to-web-endpoint-by-using-azure-cli">Next unit: Exercise: Route custom events to web endpoint by using Azure CLI</h2>
<p><a href="https://docs.microsoft.com/en-us/training/modules/azure-event-grid/8-event-grid-custom-events/">Continue</a></p>
<p>Need help? See our <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-grid.filter-events&amp;documentId=7ea15aad-b362-e8d0-cb41-8be4b180111b&amp;versionIndependentDocumentId=167f2975-9bc2-d518-4116-ed28867456f5&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-grid%2F7-event-grid-filtering.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-grid%2F7-event-grid-filtering&amp;author=jeffko">troubleshooting guide</a> or provide specific feedback by <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-grid.filter-events&amp;documentId=7ea15aad-b362-e8d0-cb41-8be4b180111b&amp;versionIndependentDocumentId=167f2975-9bc2-d518-4116-ed28867456f5&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-grid%2F7-event-grid-filtering.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-grid%2F7-event-grid-filtering&amp;author=jeffko#report-feedback">reporting an issue</a>.</p>
<h2 id="exercise-route-custom-events-to-web-endpoint-by-using-azure-cli---training--microsoft-docs.md">Exercise Route custom events to web endpoint by using Azure CLI - Training  Microsoft <a href="http://Docs.md">Docs.md</a></h2>
<ul>
<li>3 minutes</li>
</ul>
<p>In this exercise you will learn how to:</p>
<ul>
<li>Enable an Event Grid resource provider</li>
<li>Create a custom topic</li>
<li>Create a message endpoint</li>
<li>Subscribe to a custom topic</li>
<li>Send an event to a custom topic</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>An <strong>Azure account</strong> with an active subscription. If you don’t already have one, you can sign up for a free trial at <a href="https://azure.com/free">https://azure.com/free</a>.</li>
</ul>
<h2 id="create-a-resource-group">Create a resource group</h2>
<p>In this section you will open your terminal and create some variables that will be used throughout the rest of the exercise to make command entry, and unique resource name creation, a bit easier.</p>
<ol>
<li>
<p>Launch the Cloud Shell: <a href="https://shell.azure.com/">https://shell.azure.com</a></p>
</li>
<li>
<p>Select <strong>Bash</strong> as the shell.</p>
</li>
<li>
<p>Run the commands below to create the variables. Replace <code>&lt;myLocation&gt;</code> with a region near you.</p>
<pre><code>let rNum=$RANDOM*$RANDOM
myLocation=&lt;myLocation&gt;
myTopicName="az204-egtopic-${rNum}"
mySiteName="az204-egsite-${rNum}"
mySiteURL="https://${mySiteName}.azurewebsites.net"
</code></pre>
</li>
<li>
<p>Create a resource group for the new resources you will be creating.</p>
<pre><code>az group create --name az204-evgrid-rg --location $myLocation
</code></pre>
</li>
</ol>
<h2 id="enable-an-event-grid-resource-provider">Enable an Event Grid resource provider</h2>
<p>Note</p>
<p>This step is only needed on subscriptions that haven’t previously used Event Grid.</p>
<p>Register the Event Grid resource provider by using the <code>az provider register</code> command.</p>
<pre><code>az provider register --namespace Microsoft.EventGrid
</code></pre>
<p>It can take a few minutes for the registration to complete. To check the status run the command below.</p>
<pre><code>az provider show --namespace Microsoft.EventGrid --query "registrationState"
</code></pre>
<h2 id="create-a-custom-topic">Create a custom topic</h2>
<p>Create a custom topic by using the <code>az eventgrid topic create</code> command. The name must be unique because it is part of the DNS entry.</p>
<pre><code>az eventgrid topic create --name $myTopicName \
    --location $myLocation \
    --resource-group az204-evgrid-rg
</code></pre>
<h2 id="create-a-message-endpoint">Create a message endpoint</h2>
<p>Before subscribing to the custom topic, we need to create the endpoint for the event message. Typically, the endpoint takes actions based on the event data. The script below uses a pre-built web app that displays the event messages. The deployed solution includes an App Service plan, an App Service web app, and source code from GitHub. It also generates a unique name for the site.</p>
<ol>
<li>
<p>Create a message endpoint. The deployment may take a few minutes to complete.</p>
<pre><code>az deployment group create \
    --resource-group az204-evgrid-rg \
    --template-uri "https://raw.githubusercontent.com/Azure-Samples/azure-event-grid-viewer/main/azuredeploy.json" \
    --parameters siteName=$mySiteName hostingPlanName=viewerhost

echo "Your web app URL: ${mySiteURL}"
</code></pre>
<p>Note</p>
<p>This command may take a few minutes to complete.</p>
</li>
<li>
<p>In a new tab navigate to the URL generated at the end of the script above to ensure the web app is running. You should see the site with no messages currently displayed.</p>
<p>Tip</p>
<p>Leave the browser running, it is used to show updates.</p>
</li>
</ol>
<h2 id="subscribe-to-a-custom-topic">Subscribe to a custom topic</h2>
<p>You subscribe to an event grid topic to tell Event Grid which events you want to track and where to send those events.</p>
<ol>
<li>
<p>Subscribe to a custom topic by using the <code>az eventgrid event-subscription create</code> command. The script below will grab the needed subscription ID from your account and use in the creation of the event subscription.</p>
<pre><code>endpoint="${mySiteURL}/api/updates"
subId=$(az account show --subscription "" | jq -r '.id')

az eventgrid event-subscription create \
    --source-resource-id "/subscriptions/$subId/resourceGroups/az204-evgrid-rg/providers/Microsoft.EventGrid/topics/$myTopicName" \
    --name az204ViewerSub \
    --endpoint $endpoint
</code></pre>
</li>
<li>
<p>View your web app again, and notice that a subscription validation event has been sent to it. Select the eye icon to expand the event data. Event Grid sends the validation event so the endpoint can verify that it wants to receive event data. The web app includes code to validate the subscription.</p>
</li>
</ol>
<h2 id="send-an-event-to-your-custom-topic">Send an event to your custom topic</h2>
<p>Trigger an event to see how Event Grid distributes the message to your endpoint.</p>
<ol>
<li>
<p>Retrieve URL and key for the custom topic.</p>
<pre><code>topicEndpoint=$(az eventgrid topic show --name $myTopicName -g az204-evgrid-rg --query "endpoint" --output tsv)
key=$(az eventgrid topic key list --name $myTopicName -g az204-evgrid-rg --query "key1" --output tsv)
</code></pre>
</li>
<li>
<p>Create event data to send. Typically, an application or Azure service would send the event data, we’re creating data for the purposes of the exercise.</p>
<pre><code>event='[ {"id": "'"$RANDOM"'", "eventType": "recordInserted", "subject": "myapp/vehicles/motorcycles", "eventTime": "'`date +%Y-%m-%dT%H:%M:%S%z`'", "data":{ "make": "Contoso", "model": "Monster"},"dataVersion": "1.0"} ]'
</code></pre>
</li>
<li>
<p>Use <code>curl</code> to send the event to the topic.</p>
<pre><code>curl -X POST -H "aeg-sas-key: $key" -d "$event" $topicEndpoint
</code></pre>
</li>
<li>
<p>View your web app to see the event you just sent. Select the eye icon to expand the event data. Event Grid sends the validation event so the endpoint can verify that it wants to receive event data. The web app includes code to validate the subscription.</p>
<pre><code>{
"id": "29078",
"eventType": "recordInserted",
"subject": "myapp/vehicles/motorcycles",
"eventTime": "2019-12-02T22:23:03+00:00",
"data": {
    "make": "Contoso",
    "model": "Northwind"
},
"dataVersion": "1.0",
"metadataVersion": "1",
"topic": "/subscriptions/{subscription-id}/resourceGroups/az204-evgrid-rg/providers/Microsoft.EventGrid/topics/az204-egtopic-589377852"
}
</code></pre>
</li>
</ol>
<h2 id="clean-up-resources">Clean up resources</h2>
<p>When you no longer need the resources in this exercise use the following command to delete the resource group and associated resources.</p>
<pre><code>az group delete --name az204-evgrid-rg --no-wait 
</code></pre>
<p>Need help? See our <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-grid.exercise-route-custom-events-to-web-endpoint-by-using-azure-cli&amp;documentId=75f7dbe9-4607-b946-7269-535b85585aef&amp;versionIndependentDocumentId=e9a4baa4-7d91-c722-fc7c-4af179582e17&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-grid%2F8-event-grid-custom-events.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-grid%2F8-event-grid-custom-events&amp;author=jeffko">troubleshooting guide</a> or provide specific feedback by <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-grid.exercise-route-custom-events-to-web-endpoint-by-using-azure-cli&amp;documentId=75f7dbe9-4607-b946-7269-535b85585aef&amp;versionIndependentDocumentId=e9a4baa4-7d91-c722-fc7c-4af179582e17&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-grid%2F8-event-grid-custom-events.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-grid%2F8-event-grid-custom-events&amp;author=jeffko#report-feedback">reporting an issue</a>.</p>
<h2 id="explore-azure-event-hubs---training--microsoft-docs.md">Explore Azure Event Hubs - Training  Microsoft <a href="http://Docs.md">Docs.md</a></h2>
<ol>
<li><a href="https://docs.microsoft.com/en-us/">Docs</a></li>
<li><a href="https://docs.microsoft.com/en-us/learn/">Learn</a></li>
<li><a href="https://docs.microsoft.com/en-us/learn/browse/">Browse</a></li>
<li><a href="https://docs.microsoft.com/en-us/training/paths/az-204-develop-event-based-solutions/">AZ-204: Develop event-based solutions</a></li>
</ol>
<p><img src="https://docs.microsoft.com/en-us/learn/achievements/2-explore-azure-event-hubs.svg" alt=""></p>
<ul>
<li>24 min</li>
<li>Module</li>
<li>8 Units</li>
</ul>
<p>4.7 out of 5 stars from 702 votes</p>
<p>5 star 78% 78%</p>
<p>4 star 15% 15%</p>
<p>3 star 4% 4%</p>
<p>2 star 2% 2%</p>
<p>1 star 1% 1%</p>
<p>Intermediate</p>
<p>Developer</p>
<p>Event Hubs</p>
<p>Learn how Azure Event Hubs captures events and how to scale your processing application.</p>
<h2 id="learning-objectives">Learning objectives</h2>
<p>After completing this module, you’ll be able to:</p>
<ul>
<li>Describe the benefits of using Event Hubs and how it captures streaming data.</li>
<li>Explain how to process events.</li>
<li>Perform common operations with the Event Hubs client library.</li>
</ul>
<h2 id="prerequisites-1">Prerequisites</h2>
<ul>
<li>You should be familiar with developer concepts and terminology.</li>
<li>An understanding of cloud computing and some experience with the Azure portal.</li>
</ul>
<h2 id="introduction---training--microsoft-docs9.md">Introduction - Training  Microsoft Docs(9).md</h2>
<ul>
<li>3 minutes</li>
</ul>
<p>Azure Event Hubs is a big data streaming platform and event ingestion service. It can receive and process millions of events per second. Data sent to an event hub can be transformed and stored by using any real-time analytics provider or batching/storage adapters.</p>
<p>After completing this module, you’ll be able to:</p>
<ul>
<li>Describe the benefits of using Event Hubs and how it captures streaming data.</li>
<li>Explain how to process events.</li>
<li>Perform common operations with the Event Hubs client library.</li>
</ul>
<hr>
<h2 id="next-unit-discover-azure-event-hubs">Next unit: Discover Azure Event Hubs</h2>
<p><a href="https://docs.microsoft.com/en-us/training/modules/azure-event-hubs/2-event-hubs-overview/">Continue</a></p>
<p>Need help? See our <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-hubs.introduction&amp;documentId=228e78d7-634c-40f6-f269-7a6d92884258&amp;versionIndependentDocumentId=8a4c9352-3220-f639-d3f6-372b8e4083fe&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-hubs%2F1-introduction.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-hubs%2F1-introduction&amp;author=jeffko">troubleshooting guide</a> or provide specific feedback by <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-hubs.introduction&amp;documentId=228e78d7-634c-40f6-f269-7a6d92884258&amp;versionIndependentDocumentId=8a4c9352-3220-f639-d3f6-372b8e4083fe&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-hubs%2F1-introduction.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-hubs%2F1-introduction&amp;author=jeffko#report-feedback">reporting an issue</a>.</p>
<h2 id="discover-azure-event-hubs---training--microsoft-docs.md">Discover Azure Event Hubs - Training  Microsoft <a href="http://Docs.md">Docs.md</a></h2>
<ul>
<li>3 minutes</li>
</ul>
<p>Azure Event Hubs represents the “front door” for an event pipeline, often called an <em>event ingestor</em> in solution architectures. An event ingestor is a component or service that sits between event publishers and event consumers to decouple the production of an event stream from the consumption of those events. Event Hubs provides a unified streaming platform with time retention buffer, decoupling event producers from event consumers.</p>
<p>The table below highlights key features of the Azure Event Hubs service:</p>

<table>
<thead>
<tr>
<th>Feature</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fully managed PaaS</td>
<td>Event Hubs is a fully managed Platform-as-a-Service (PaaS) with little configuration or management overhead, so you focus on your business solutions. Event Hubs for Apache Kafka ecosystems gives you the PaaS Kafka experience without having to manage, configure, or run your clusters.</td>
</tr>
<tr>
<td>Real-time and batch processing</td>
<td>Event Hubs uses a partitioned consumer model, enabling multiple applications to process the stream concurrently and letting you control the speed of processing.</td>
</tr>
<tr>
<td>Scalable</td>
<td>Scaling options, like Auto-inflate, scale the number of throughput units to meet your usage needs.</td>
</tr>
<tr>
<td>Rich ecosystem</td>
<td>Event Hubs for Apache Kafka ecosystems enables Apache Kafka (1.0 and later) clients and applications to talk to Event Hubs. You do not need to set up, configure, and manage your own Kafka clusters.</td>
</tr>
</tbody>
</table><h2 id="key-concepts">Key concepts</h2>
<p>Event Hubs contains the following key components:</p>
<ul>
<li>An <strong>Event Hub client</strong> is the primary interface for developers interacting with the Event Hubs client library. There are several different Event Hub clients, each dedicated to a specific use of Event Hubs, such as publishing or consuming events.</li>
<li>An <strong>Event Hub producer</strong> is a type of client that serves as a source of telemetry data, diagnostics information, usage logs, or other log data, as part of an embedded device solution, a mobile device application, a game title running on a console or other device, some client or server based business solution, or a web site.</li>
<li>An <strong>Event Hub consumer</strong> is a type of client which reads information from the Event Hub and allows processing of it. Processing may involve aggregation, complex computation and filtering. Processing may also involve distribution or storage of the information in a raw or transformed fashion. Event Hub consumers are often robust and high-scale platform infrastructure parts with built-in analytics capabilities, like Azure Stream Analytics, Apache Spark, or Apache Storm.</li>
<li>A <strong>partition</strong> is an ordered sequence of events that is held in an Event Hub. Partitions are a means of data organization associated with the parallelism required by event consumers. Azure Event Hubs provides message streaming through a partitioned consumer pattern in which each consumer only reads a specific subset, or partition, of the message stream. As newer events arrive, they are added to the end of this sequence. The number of partitions is specified at the time an Event Hub is created and cannot be changed.</li>
<li>A <strong>consumer group</strong> is a view of an entire Event Hub. Consumer groups enable multiple consuming applications to each have a separate view of the event stream, and to read the stream independently at their own pace and from their own position. There can be at most 5 concurrent readers on a partition per consumer group; however it is recommended that there is only one active consumer for a given partition and consumer group pairing. Each active reader receives all of the events from its partition; if there are multiple readers on the same partition, then they will receive duplicate events.</li>
<li><strong>Event receivers</strong>: Any entity that reads event data from an event hub. All Event Hubs consumers connect via the AMQP 1.0 session. The Event Hubs service delivers events through a session as they become available. All Kafka consumers connect via the Kafka protocol 1.0 and later.</li>
<li><strong>Throughput units</strong> or <strong>processing units</strong>: Pre-purchased units of capacity that control the throughput capacity of Event Hubs.</li>
</ul>
<p>The following figure shows the Event Hubs stream processing architecture:</p>
<p><img src="https://docs.microsoft.com/en-us/training/wwl-azure/azure-event-hubs/media/event-hubs-stream-processing.png" alt="Image showing the event processing flow."></p>
<hr>
<h2 id="next-unit-explore-event-hubs-capture">Next unit: Explore Event Hubs Capture</h2>
<p><a href="https://docs.microsoft.com/en-us/training/modules/azure-event-hubs/3-event-hubs-capture/">Continue</a></p>
<p>Need help? See our <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-hubs.discover&amp;documentId=b9232b06-4b84-8383-d28d-79e8649b1f47&amp;versionIndependentDocumentId=15b5702a-1b9c-06d0-f029-7a74ee16e850&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-hubs%2F2-event-hubs-overview.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-hubs%2F2-event-hubs-overview&amp;author=jeffko">troubleshooting guide</a> or provide specific feedback by <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-hubs.discover&amp;documentId=b9232b06-4b84-8383-d28d-79e8649b1f47&amp;versionIndependentDocumentId=15b5702a-1b9c-06d0-f029-7a74ee16e850&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-hubs%2F2-event-hubs-overview.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-hubs%2F2-event-hubs-overview&amp;author=jeffko#report-feedback">reporting an issue</a>.</p>
<h2 id="explore-event-hubs-capture---training--microsoft-docs.md">Explore Event Hubs Capture - Training  Microsoft <a href="http://Docs.md">Docs.md</a></h2>
<ul>
<li>3 minutes</li>
</ul>
<p>Azure Event Hubs enables you to automatically capture the streaming data in Event Hubs in an Azure Blob storage or Azure Data Lake Storage account of your choice, with the added flexibility of specifying a time or size interval. Setting up Capture is fast, there are no administrative costs to run it, and it scales automatically with Event Hubs throughput units in the standard tier or processing units in the premium tier.</p>
<p><img src="https://docs.microsoft.com/en-us/training/wwl-azure/azure-event-hubs/media/event-hubs-capture.png" alt="Image showing capturing of Event Hubs data into Azure Storage or Azure Data Lake Storage"></p>
<p>Event Hubs Capture enables you to process real-time and batch-based pipelines on the same stream. This means you can build solutions that grow with your needs over time.</p>
<h2 id="how-event-hubs-capture-works">How Event Hubs Capture works</h2>
<p>Event Hubs is a time-retention durable buffer for telemetry ingress, similar to a distributed log. The key to scaling in Event Hubs is the partitioned consumer model. Each partition is an independent segment of data and is consumed independently. Over time this data ages off, based on the configurable retention period. As a result, a given event hub never gets “too full.”</p>
<p>Event Hubs Capture enables you to specify your own Azure Blob storage account and container, or Azure Data Lake Store account, which are used to store the captured data. These accounts can be in the same region as your event hub or in another region, adding to the flexibility of the Event Hubs Capture feature.</p>
<p>Captured data is written in Apache Avro format: a compact, fast, binary format that provides rich data structures with inline schema. This format is widely used in the Hadoop ecosystem, Stream Analytics, and Azure Data Factory. More information about working with Avro is available later in this article.</p>
<h2 id="capture-windowing">Capture windowing</h2>
<p>Event Hubs Capture enables you to set up a window to control capturing. This window is a minimum size and time configuration with a “first wins policy,” meaning that the first trigger encountered causes a capture operation. Each partition captures independently and writes a completed block blob at the time of capture, named for the time at which the capture interval was encountered. The storage naming convention is as follows:</p>
<pre><code>{Namespace}/{EventHub}/{PartitionId}/{Year}/{Month}/{Day}/{Hour}/{Minute}/{Second}
</code></pre>
<p>Note that the date values are padded with zeroes; an example filename might be:</p>
<pre><code>https://mystorageaccount.blob.core.windows.net/mycontainer/mynamespace/myeventhub/0/2017/12/08/03/03/17.avro
</code></pre>
<h2 id="scaling-to-throughput-units">Scaling to throughput units</h2>
<p>Event Hubs traffic is controlled by throughput units. A single throughput unit allows 1 MB per second or 1000 events per second of ingress and twice that amount of egress. Standard Event Hubs can be configured with 1-20 throughput units, and you can purchase more with a quota increase support request. Usage beyond your purchased throughput units is throttled. Event Hubs Capture copies data directly from the internal Event Hubs storage, bypassing throughput unit egress quotas and saving your egress for other processing readers, such as Stream Analytics or Spark.</p>
<p>Once configured, Event Hubs Capture runs automatically when you send your first event, and continues running. To make it easier for your downstream processing to know that the process is working, Event Hubs writes empty files when there is no data. This process provides a predictable cadence and marker that can feed your batch processors.</p>
<hr>
<h2 id="next-unit-scale-your-processing-application">Next unit: Scale your processing application</h2>
<p><a href="https://docs.microsoft.com/en-us/training/modules/azure-event-hubs/4-event-processing/">Continue</a></p>
<p>Need help? See our <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-hubs.explore-capture&amp;documentId=4f51a5c0-f7b2-a86c-731f-0ee31796b313&amp;versionIndependentDocumentId=a46f9758-1c1c-1c09-a046-f9e0baf706f3&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-hubs%2F3-event-hubs-capture.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-hubs%2F3-event-hubs-capture&amp;author=jeffko">troubleshooting guide</a> or provide specific feedback by <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-hubs.explore-capture&amp;documentId=4f51a5c0-f7b2-a86c-731f-0ee31796b313&amp;versionIndependentDocumentId=a46f9758-1c1c-1c09-a046-f9e0baf706f3&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-hubs%2F3-event-hubs-capture.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-hubs%2F3-event-hubs-capture&amp;author=jeffko#report-feedback">reporting an issue</a>.</p>
<h2 id="scale-your-processing-application---training--microsoft-docs.md">Scale your processing application - Training  Microsoft <a href="http://Docs.md">Docs.md</a></h2>
<ul>
<li>3 minutes</li>
</ul>
<p>To scale your event processing application, you can run multiple instances of the application and have it balance the load among themselves. In the older versions, <strong>EventProcessorHost</strong> allowed you to balance the load between multiple instances of your program and checkpoint events when receiving. In the newer versions (5.0 onwards), <strong>EventProcessorClient</strong> (.NET and Java), or <strong>EventHubConsumerClient</strong> (Python and JavaScript) allows you to do the same.</p>
<p>Note</p>
<p>The key to scale for Event Hubs is the idea of partitioned consumers. In contrast to the competing consumers pattern, the partitioned consumer pattern enables high scale by removing the contention bottleneck and facilitating end to end parallelism.</p>
<h2 id="example-scenario">Example scenario</h2>
<p>As an example scenario, consider a home security company that monitors 100,000 homes. Every minute, it gets data from various sensors such as a motion detector, door/window open sensor, glass break detector, and so on, installed in each home. The company provides a web site for residents to monitor the activity of their home in near real time.</p>
<p>Each sensor pushes data to an event hub. The event hub is configured with 16 partitions. On the consuming end, you need a mechanism that can read these events, consolidate them, and dump the aggregate to a storage blob, which is then projected to a user-friendly web page.</p>
<p>When designing the consumer in a distributed environment, the scenario must handle the following requirements:</p>
<ul>
<li><strong>Scale:</strong> Create multiple consumers, with each consumer taking ownership of reading from a few Event Hubs partitions.</li>
<li><strong>Load balance:</strong> Increase or reduce the consumers dynamically. For example, when a new sensor type (for example, a carbon monoxide detector) is added to each home, the number of events increases. In that case, the operator (a human) increases the number of consumer instances. Then, the pool of consumers can rebalance the number of partitions they own, to share the load with the newly added consumers.</li>
<li><strong>Seamless resume on failures:</strong> If a consumer (<strong>consumer A</strong>) fails (for example, the virtual machine hosting the consumer suddenly crashes), then other consumers can pick up the partitions owned by <strong>consumer A</strong> and continue. Also, the continuation point, called a <em>checkpoint</em> or <em>offset</em>, should be at the exact point at which <strong>consumer A</strong> failed, or slightly before that.</li>
<li><strong>Consume events:</strong> While the previous three points deal with the management of the consumer, there must be code to consume the events and do something useful with it. For example, aggregate it and upload it to blob storage.</li>
</ul>
<h2 id="event-processor-or-consumer-client">Event processor or consumer client</h2>
<p>You don’t need to build your own solution to meet these requirements. The Azure Event Hubs SDKs provide this functionality. In .NET or Java SDKs, you use an event processor client (<code>EventProcessorClient</code>), and in Python and JavaScript SDKs, you use <code>EventHubConsumerClient</code>.</p>
<p>For most production scenarios, we recommend that you use the event processor client for reading and processing events. Event processor clients can work cooperatively within the context of a consumer group for a given event hub. Clients will automatically manage distribution and balancing of work as instances become available or unavailable for the group.</p>
<h2 id="partition-ownership-tracking">Partition ownership tracking</h2>
<p>An event processor instance typically owns and processes events from one or more partitions. Ownership of partitions is evenly distributed among all the active event processor instances associated with an event hub and consumer group combination.</p>
<p>Each event processor is given a unique identifier and claims ownership of partitions by adding or updating an entry in a checkpoint store. All event processor instances communicate with this store periodically to update its own processing state as well as to learn about other active instances. This data is then used to balance the load among the active processors.</p>
<h2 id="receive-messages">Receive messages</h2>
<p>When you create an event processor, you specify the functions that will process events and errors. Each call to the function that processes events delivers a single event from a specific partition. It’s your responsibility to handle this event. If you want to make sure the consumer processes every message at least once, you need to write your own code with retry logic. But be cautious about poisoned messages.</p>
<p>We recommend that you do things relatively fast. That is, do as little processing as possible. If you need to write to storage and do some routing, it’s better to use two consumer groups and have two event processors.</p>
<h2 id="checkpointing">Checkpointing</h2>
<p><em>Checkpointing</em> is a process by which an event processor marks or commits the position of the last successfully processed event within a partition. Marking a checkpoint is typically done within the function that processes the events and occurs on a per-partition basis within a consumer group.</p>
<p>If an event processor disconnects from a partition, another instance can resume processing the partition at the checkpoint that was previously committed by the last processor of that partition in that consumer group. When the processor connects, it passes the offset to the event hub to specify the location at which to start reading. In this way, you can use checkpointing to both mark events as “complete” by downstream applications and to provide resiliency when an event processor goes down. It’s possible to return to older data by specifying a lower offset from this checkpointing process.</p>
<h2 id="thread-safety-and-processor-instances">Thread safety and processor instances</h2>
<p>By default, the function that processes the events is called sequentially for a given partition. Subsequent events and calls to this function from the same partition queue up behind the scenes as the event pump continues to run in the background on other threads. Events from different partitions can be processed concurrently and any shared state that is accessed across partitions have to be synchronized.</p>
<hr>
<h2 id="next-unit-control-access-to-events-1">Next unit: Control access to events</h2>
<p><a href="https://docs.microsoft.com/en-us/training/modules/azure-event-hubs/5-event-hubs-authentication-authorization/">Continue</a></p>
<p>Need help? See our <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-hubs.scale-your-processing-application&amp;documentId=23930062-7efd-ed13-65cf-5a24012deaad&amp;versionIndependentDocumentId=0abdc80f-280c-5919-7af7-c167c4be0562&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-hubs%2F4-event-processing.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-hubs%2F4-event-processing&amp;author=jeffko">troubleshooting guide</a> or provide specific feedback by <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-hubs.scale-your-processing-application&amp;documentId=23930062-7efd-ed13-65cf-5a24012deaad&amp;versionIndependentDocumentId=0abdc80f-280c-5919-7af7-c167c4be0562&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-hubs%2F4-event-processing.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-hubs%2F4-event-processing&amp;author=jeffko#report-feedback">reporting an issue</a>.</p>
<h2 id="control-access-to-events---training--microsoft-docs1.md">Control access to events - Training  Microsoft Docs(1).md</h2>
<ul>
<li>3 minutes</li>
</ul>
<p>Azure Event Hubs supports both Azure Active Directory and shared access signatures (SAS) to handle both authentication and authorization. Azure provides the following Azure built-in roles for authorizing access to Event Hubs data using Azure Active Directory and OAuth:</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#azure-event-hubs-data-owner">Azure Event Hubs Data Owner</a>: Use this role to give <em>complete access</em> to Event Hubs resources.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#azure-event-hubs-data-sender">Azure Event Hubs Data Sender</a>: Use this role to give <em>send access</em> to Event Hubs resources.</li>
<li><a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#azure-event-hubs-data-receiver">Azure Event Hubs Data Receiver</a>: Use this role to give <em>receiving access</em> to Event Hubs resources.</li>
</ul>
<p>To authorize a request to Event Hubs service from a managed identity in your application, you need to configure Azure role-based access control settings for that managed identity. Azure Event Hubs defines Azure roles that encompass permissions for sending and reading from Event Hubs. When the Azure role is assigned to a managed identity, the managed identity is granted access to Event Hubs data at the appropriate scope.</p>
<h2 id="authorize-access-with-microsoft-identity-platform">Authorize access with Microsoft Identity Platform</h2>
<p>A key advantage of using Azure AD with Event Hubs is that your credentials no longer need to be stored in your code. Instead, you can request an OAuth 2.0 access token from Microsoft identity platform. Azure AD authenticates the security principal (a user, a group, or service principal) running the application. If authentication succeeds, Azure AD returns the access token to the application, and the application can then use the access token to authorize requests to Azure Event Hubs.</p>
<p>An event publisher defines a virtual endpoint for an Event Hub. The publisher can only be used to send messages to an event hub and not receive messages. Typically, an event hub employs one publisher per client. All messages that are sent to any of the publishers of an event hub are enqueued within that event hub. Publishers enable fine-grained access control.</p>
<p>Each Event Hubs client is assigned a unique token which is uploaded to the client. A client that holds a token can only send to one publisher, and no other publisher. If multiple clients share the same token, then each of them shares the publisher.</p>
<p>All tokens are assigned with shared access signature keys. Typically, all tokens are signed with the same key. Clients aren’t aware of the key, which prevents clients from manufacturing tokens. Clients operate on the same tokens until they expire.</p>
<p>To authenticate back-end applications that consume from the data generated by Event Hubs producers, Event Hubs token authentication requires its clients to either have the <strong>manage</strong> rights or the <strong>listen</strong> privileges assigned to its Event Hubs namespace or event hub instance or topic. Data is consumed from Event Hubs using consumer groups. While SAS policy gives you granular scope, this scope is defined only at the entity level and not at the consumer level. It means that the privileges defined at the namespace level or the event hub instance or topic level will be applied to the consumer groups of that entity.</p>
<hr>
<h2 id="next-unit-perform-common-operations-with-the-event-hubs-client-library">Next unit: Perform common operations with the Event Hubs client library</h2>
<p><a href="https://docs.microsoft.com/en-us/training/modules/azure-event-hubs/6-event-hubs-programming-guide/">Continue</a></p>
<p>Need help? See our <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-hubs.control-access-to-events&amp;documentId=ead45971-26ab-e41f-561d-e193b180f4f5&amp;versionIndependentDocumentId=d6443f6f-a8f0-0e59-a63f-643a6b90cfe1&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-hubs%2F5-event-hubs-authentication-authorization.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-hubs%2F5-event-hubs-authentication-authorization&amp;author=jeffko">troubleshooting guide</a> or provide specific feedback by <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-hubs.control-access-to-events&amp;documentId=ead45971-26ab-e41f-561d-e193b180f4f5&amp;versionIndependentDocumentId=d6443f6f-a8f0-0e59-a63f-643a6b90cfe1&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-hubs%2F5-event-hubs-authentication-authorization.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-hubs%2F5-event-hubs-authentication-authorization&amp;author=jeffko#report-feedback">reporting an issue</a>.</p>
<h2 id="perform-common-operations-with-the-event-hubs-client-library---training--microsoft-docs.md">Perform common operations with the Event Hubs client library - Training  Microsoft <a href="http://Docs.md">Docs.md</a></h2>
<ul>
<li>3 minutes</li>
</ul>
<p>This unit contains examples of common operations you can perform with the Event Hubs client library (<code>Azure.Messaging.EventHubs</code>) to interact with an Event Hub.</p>
<h2 id="inspect-an-event-hub">Inspect an Event Hub</h2>
<p>Many Event Hub operations take place within the scope of a specific partition. Because partitions are owned by the Event Hub, their names are assigned at the time of creation. To understand what partitions are available, you query the Event Hub using one of the Event Hub clients. For illustration, the <code>EventHubProducerClient</code> is demonstrated in these examples, but the concept and form are common across clients.</p>
<pre><code>var connectionString = "&lt;&lt; CONNECTION STRING FOR THE EVENT HUBS NAMESPACE &gt;&gt;";
var eventHubName = "&lt;&lt; NAME OF THE EVENT HUB &gt;&gt;";

await using (var producer = new EventHubProducerClient(connectionString, eventHubName))
{
    string[] partitionIds = await producer.GetPartitionIdsAsync();
}
</code></pre>
<h2 id="publish-events-to-an-event-hub">Publish events to an Event Hub</h2>
<p>In order to publish events, you’ll need to create an <code>EventHubProducerClient</code>. Producers publish events in batches and may request a specific partition, or allow the Event Hubs service to decide which partition events should be published to. We recommended using automatic routing when the publishing of events needs to be highly available or when event data should be distributed evenly among the partitions. Our example will take advantage of automatic routing.</p>
<pre><code>var connectionString = "&lt;&lt; CONNECTION STRING FOR THE EVENT HUBS NAMESPACE &gt;&gt;";
var eventHubName = "&lt;&lt; NAME OF THE EVENT HUB &gt;&gt;";

await using (var producer = new EventHubProducerClient(connectionString, eventHubName))
{
    using EventDataBatch eventBatch = await producer.CreateBatchAsync();
    eventBatch.TryAdd(new EventData(new BinaryData("First")));
    eventBatch.TryAdd(new EventData(new BinaryData("Second")));

    await producer.SendAsync(eventBatch);
}
</code></pre>
<h2 id="read-events-from-an-event-hub">Read events from an Event Hub</h2>
<p>In order to read events from an Event Hub, you’ll need to create an <code>EventHubConsumerClient</code> for a given consumer group. When an Event Hub is created, it provides a default consumer group that can be used to get started with exploring Event Hubs. In our example, we will focus on reading all events that have been published to the Event Hub using an iterator.</p>
<p>Note</p>
<p>It is important to note that this approach to consuming is intended to improve the experience of exploring the Event Hubs client library and prototyping. It is recommended that it not be used in production scenarios. For production use, we recommend using the <a href="https://github.com/Azure/azure-sdk-for-net/blob/main/sdk/eventhub/Azure.Messaging.EventHubs.Processor">Event Processor Client</a>, as it provides a more robust and performant experience.</p>
<pre><code>var connectionString = "&lt;&lt; CONNECTION STRING FOR THE EVENT HUBS NAMESPACE &gt;&gt;";
var eventHubName = "&lt;&lt; NAME OF THE EVENT HUB &gt;&gt;";

string consumerGroup = EventHubConsumerClient.DefaultConsumerGroupName;

await using (var consumer = new EventHubConsumerClient(consumerGroup, connectionString, eventHubName))
{
    using var cancellationSource = new CancellationTokenSource();
    cancellationSource.CancelAfter(TimeSpan.FromSeconds(45));

    await foreach (PartitionEvent receivedEvent in consumer.ReadEventsAsync(cancellationSource.Token))
    {
        // At this point, the loop will wait for events to be available in the Event Hub.  When an event
        // is available, the loop will iterate with the event that was received.  Because we did not
        // specify a maximum wait time, the loop will wait forever unless cancellation is requested using
        // the cancellation token.
    }
}
</code></pre>
<h2 id="read-events-from-an-event-hub-partition">Read events from an Event Hub partition</h2>
<p>To read from a specific partition, the consumer will need to specify where in the event stream to begin receiving events; in our example, we will focus on reading all published events for the first partition of the Event Hub.</p>
<pre><code>var connectionString = "&lt;&lt; CONNECTION STRING FOR THE EVENT HUBS NAMESPACE &gt;&gt;";
var eventHubName = "&lt;&lt; NAME OF THE EVENT HUB &gt;&gt;";

string consumerGroup = EventHubConsumerClient.DefaultConsumerGroupName;

await using (var consumer = new EventHubConsumerClient(consumerGroup, connectionString, eventHubName))
{
    EventPosition startingPosition = EventPosition.Earliest;
    string partitionId = (await consumer.GetPartitionIdsAsync()).First();

    using var cancellationSource = new CancellationTokenSource();
    cancellationSource.CancelAfter(TimeSpan.FromSeconds(45));

    await foreach (PartitionEvent receivedEvent in consumer.ReadEventsFromPartitionAsync(partitionId, startingPosition, cancellationSource.Token))
    {
        // At this point, the loop will wait for events to be available in the partition.  When an event
        // is available, the loop will iterate with the event that was received.  Because we did not
        // specify a maximum wait time, the loop will wait forever unless cancellation is requested using
        // the cancellation token.
    }
}
</code></pre>
<h2 id="process-events-using-an-event-processor-client">Process events using an Event Processor client</h2>
<p>For most production scenarios, it is recommended that the <code>EventProcessorClient</code> be used for reading and processing events. Since the <code>EventProcessorClient</code> has a dependency on Azure Storage blobs for persistence of its state, you’ll need to provide a <code>BlobContainerClient</code> for the processor, which has been configured for the storage account and container that should be used.</p>
<pre><code>var cancellationSource = new CancellationTokenSource();
cancellationSource.CancelAfter(TimeSpan.FromSeconds(45));

var storageConnectionString = "&lt;&lt; CONNECTION STRING FOR THE STORAGE ACCOUNT &gt;&gt;";
var blobContainerName = "&lt;&lt; NAME OF THE BLOB CONTAINER &gt;&gt;";

var eventHubsConnectionString = "&lt;&lt; CONNECTION STRING FOR THE EVENT HUBS NAMESPACE &gt;&gt;";
var eventHubName = "&lt;&lt; NAME OF THE EVENT HUB &gt;&gt;";
var consumerGroup = "&lt;&lt; NAME OF THE EVENT HUB CONSUMER GROUP &gt;&gt;";

Task processEventHandler(ProcessEventArgs eventArgs) =&gt; Task.CompletedTask;
Task processErrorHandler(ProcessErrorEventArgs eventArgs) =&gt; Task.CompletedTask;

var storageClient = new BlobContainerClient(storageConnectionString, blobContainerName);
var processor = new EventProcessorClient(storageClient, consumerGroup, eventHubsConnectionString, eventHubName);

processor.ProcessEventAsync += processEventHandler;
processor.ProcessErrorAsync += processErrorHandler;

await processor.StartProcessingAsync();

try
{
    // The processor performs its work in the background; block until cancellation
    // to allow processing to take place.

    await Task.Delay(Timeout.Infinite, cancellationSource.Token);
}
catch (TaskCanceledException)
{
    // This is expected when the delay is canceled.
}

try
{
    await processor.StopProcessingAsync();
}
finally
{
    // To prevent leaks, the handlers should be removed when processing is complete.

    processor.ProcessEventAsync -= processEventHandler;
    processor.ProcessErrorAsync -= processErrorHandler;
}
</code></pre>
<p>Need help? See our <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-hubs.perform-common-operations-client-library&amp;documentId=4282a6d7-c87f-6996-2d4b-9dabc171e45e&amp;versionIndependentDocumentId=77f69637-d9aa-ab5c-e25d-f9b15e307f63&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-hubs%2F6-event-hubs-programming-guide.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-hubs%2F6-event-hubs-programming-guide&amp;author=jeffko">troubleshooting guide</a> or provide specific feedback by <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.azure-event-hubs.perform-common-operations-client-library&amp;documentId=4282a6d7-c87f-6996-2d4b-9dabc171e45e&amp;versionIndependentDocumentId=77f69637-d9aa-ab5c-e25d-f9b15e307f63&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fazure-event-hubs%2F6-event-hubs-programming-guide.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fazure-event-hubs%2F6-event-hubs-programming-guide&amp;author=jeffko#report-feedback">reporting an issue</a>.</p>
<h2 id="az-204-develop-message-based-solutions---training--microsoft-docs.md">AZ-204 Develop message-based solutions - Training  Microsoft <a href="http://Docs.md">Docs.md</a></h2>
<ol>
<li><a href="https://docs.microsoft.com/en-us/">Docs</a></li>
<li><a href="https://docs.microsoft.com/en-us/learn/">Learn</a></li>
<li><a href="https://docs.microsoft.com/en-us/learn/browse/">Browse</a></li>
</ol>
<p><img src="https://docs.microsoft.com/en-us/learn/achievements/message-develop-solutions.svg" alt=""></p>
<ul>
<li>57 min</li>
<li>Learning Path</li>
<li>1 Modules</li>
</ul>
<p>Intermediate</p>
<p>Developer</p>
<p>Queue Storage</p>
<p>Service Bus</p>
<p>Learn how to build applications with message-based architectures by integrating Azure Service Bus and Azure Queue Storage in to your solution.</p>
<h2 id="prerequisites-2">Prerequisites</h2>
<ul>
<li>At least one year of experience developing scalable solutions through all phases of software development.</li>
<li>Have a base understanding of Azure and cloud concepts, services, and the Azure portal.</li>
<li>If you are new to Azure or cloud computing it is recommended you complete the <a href="https://docs.microsoft.com/en-us/learn/paths/az-900-describe-cloud-concepts/">AZ-900: Azure Fundamentals</a> course.</li>
</ul>
<h3 id="modules-in-this-learning-path">Modules in this learning path</h3>
<p><img src="https://docs.microsoft.com/en-us/learn/achievements/discover-message-queue.svg" alt=""></p>
<p>Learn how to integrate Azure Service Bus and Azure Queue storage in to your solution, and how to send and receive message by using .NET.</p>
<p><a href="https://docs.microsoft.com/en-us/training/modules/discover-azure-message-queue/1-introduction/">Start</a></p>
<h2 id="discover-azure-message-queues---training--microsoft-docs.md">Discover Azure message queues - Training  Microsoft <a href="http://Docs.md">Docs.md</a></h2>
<p>Learn how to integrate Azure Service Bus and Azure Queue storage in to your solution, and how to send and receive message by using .NET.</p>
<p>After completing this module, you’ll be able to:</p>
<ul>
<li>Choose the appropriate queue mechanism for your solution.</li>
<li>Explain how the messaging entities that form the core capabilities of Service Bus operate.</li>
<li>Send and receive message from a Service Bus queue by using .NET.</li>
<li>Identify the key components of Azure Queue Storage</li>
<li>Create queues and manage messages in Azure Queue Storage by using .NET.</li>
</ul>
<h2 id="introduction---training--microsoft-docs10.md">Introduction - Training  Microsoft Docs(10).md</h2>
<ul>
<li>3 minutes</li>
</ul>
<p>Azure supports two types of queue mechanisms: <strong>Service Bus queues</strong> and <strong>Storage queues</strong>.</p>
<p>Service Bus queues are part of a broader Azure messaging infrastructure that supports queuing, publish/subscribe, and more advanced integration patterns. They’re designed to integrate applications or application components that may span multiple communication protocols, data contracts, trust domains, or network environments.</p>
<p>Storage queues are part of the Azure Storage infrastructure. They allow you to store large numbers of messages. You access messages from anywhere in the world via authenticated calls using HTTP or HTTPS. A queue message can be up to 64 KB in size. A queue may contain millions of messages, up to the total capacity limit of a storage account. Queues are commonly used to create a backlog of work to process asynchronously.</p>
<p>After completing this module, you’ll be able to:</p>
<ul>
<li>Choose the appropriate queue mechanism for your solution.</li>
<li>Explain how the messaging entities that form the core capabilities of Service Bus operate.</li>
<li>Send and receive message from a Service Bus queue by using .NET.</li>
<li>Identify the key components of Azure Queue Storage</li>
<li>Create queues and manage messages in Azure Queue Storage by using .NET.</li>
</ul>
<hr>
<h2 id="next-unit-choose-a-message-queue-solution">Next unit: Choose a message queue solution</h2>
<p><a href="https://docs.microsoft.com/en-us/training/modules/discover-azure-message-queue/2-choose-queue-solution/">Continue</a></p>
<p>Need help? See our <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.discover-azure-message-queue.introduction&amp;documentId=1e3aa97b-f121-43ed-06c3-409f12a3684d&amp;versionIndependentDocumentId=557f38a1-8e30-ac0b-7ea2-c7be0c3ed05a&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fdiscover-azure-message-queue%2F1-introduction.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fdiscover-azure-message-queue%2F1-introduction&amp;author=jeffko">troubleshooting guide</a> or provide specific feedback by <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.discover-azure-message-queue.introduction&amp;documentId=1e3aa97b-f121-43ed-06c3-409f12a3684d&amp;versionIndependentDocumentId=557f38a1-8e30-ac0b-7ea2-c7be0c3ed05a&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fdiscover-azure-message-queue%2F1-introduction.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fdiscover-azure-message-queue%2F1-introduction&amp;author=jeffko#report-feedback">reporting an issue</a>.</p>
<h2 id="choose-a-message-queue-solution---training--microsoft-docs.md">Choose a message queue solution - Training  Microsoft <a href="http://Docs.md">Docs.md</a></h2>
<ul>
<li>3 minutes</li>
</ul>
<p>Storage queues and Service Bus queues have a slightly different feature set. You can choose either one or both, depending on the needs of your particular solution.</p>
<p>When determining which queuing technology fits the purpose of a given solution, solution architects and developers should consider these recommendations.</p>
<h2 id="consider-using-service-bus-queues">Consider using Service Bus queues</h2>
<p>As a solution architect/developer, <strong>you should consider using Service Bus queues</strong> when:</p>
<ul>
<li>Your solution needs to receive messages without having to poll the queue. With Service Bus, you can achieve it by using a long-polling receive operation using the TCP-based protocols that Service Bus supports.</li>
<li>Your solution requires the queue to provide a guaranteed first-in-first-out (FIFO) ordered delivery.</li>
<li>Your solution needs to support automatic duplicate detection.</li>
<li>You want your application to process messages as parallel long-running streams (messages are associated with a stream using the <strong>session ID</strong> property on the message). In this model, each node in the consuming application competes for streams, as opposed to messages. When a stream is given to a consuming node, the node can examine the state of the application stream state using transactions.</li>
<li>Your solution requires transactional behavior and atomicity when sending or receiving multiple messages from a queue.</li>
<li>Your application handles messages that can exceed 64 KB but won’t likely approach the 256-KB limit.</li>
</ul>
<h2 id="consider-using-storage-queues">Consider using Storage queues</h2>
<p>As a solution architect/developer, <strong>you should consider using Storage queues</strong> when:</p>
<ul>
<li>Your application must store over 80 gigabytes of messages in a queue.</li>
<li>Your application wants to track progress for processing a message in the queue. It’s useful if the worker processing a message crashes. Another worker can then use that information to continue from where the prior worker left off.</li>
<li>You require server side logs of all of the transactions executed against your queues.</li>
</ul>
<hr>
<h2 id="next-unit-explore-azure-service-bus">Next unit: Explore Azure Service Bus</h2>
<p><a href="https://docs.microsoft.com/en-us/training/modules/discover-azure-message-queue/3-azure-service-bus-overview/">Continue</a></p>
<p>Need help? See our <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.discover-azure-message-queue.choose-solution&amp;documentId=6693346f-a615-f0b1-041a-7e8c12c82ad7&amp;versionIndependentDocumentId=19e58cb3-a804-6309-13a4-2996acdea1ad&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fdiscover-azure-message-queue%2F2-choose-queue-solution.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fdiscover-azure-message-queue%2F2-choose-queue-solution&amp;author=jeffko">troubleshooting guide</a> or provide specific feedback by <a href="https://docs.microsoft.com/en-us/training/support/troubleshooting?uid=learn.wwl.discover-azure-message-queue.choose-solution&amp;documentId=6693346f-a615-f0b1-041a-7e8c12c82ad7&amp;versionIndependentDocumentId=19e58cb3-a804-6309-13a4-2996acdea1ad&amp;contentPath=%2FMicrosoftDocs%2Flearn-pr%2Fblob%2Flive%2Flearn-pr%2Fwwl-azure%2Fdiscover-azure-message-queue%2F2-choose-queue-solution.yml&amp;url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Ftraining%2Fmodules%2Fdiscover-azure-message-queue%2F2-choose-queue-solution&amp;author=jeffko#report-feedback">reporting an issue</a>.</p>
<h2 id="explore-azure-service-bus---training--microsoft-docs.md">Explore Azure Service Bus - Training  Microsoft <a href="http://Docs.md">Docs.md</a></h2>
<ul>
<li>3 minutes</li>
</ul>
<p>Microsoft Azure Service Bus is a fully managed enterprise integration message broker. Service Bus can decouple applications and services. Data is transferred between different applications and services using <strong>messages</strong>. A message is a container decorated with metadata, and contains data. The data can be any kind of information, including structured data encoded with the common formats such as the following ones: JSON, XML, Apache Avro, Plain Text.</p>
<p>Some common messaging scenarios are:</p>
<ul>
<li><em>Messaging</em>. Transfer business data, such as sales or purchase orders, journals, or inventory movements.</li>
<li><em>Decouple applications</em>. Improve reliability and scalability of applications and services. Client and service don’t have to be online at the same time.</li>
<li><em>Topics and subscriptions</em>. Enable 1:<em>n</em> relationships between publishers and subscribers.</li>
<li><em>Message sessions</em>. Implement workflows that require message ordering or message deferral.</li>
</ul>
<h2 id="service-bus-tiers">Service Bus tiers</h2>
<p>Service Bus offers a standard and premium tier. The <em>premium</em> tier of Service Bus Messaging addresses common customer requests around scale, performance, and availability for mission-critical applications. The premium tier is recommended for production scenarios. Although the feature sets are nearly identical, these two tiers of Service Bus Messaging are designed to serve different use cases.</p>
<p>Some high-level differences are highlighted in the following table.</p>

<table>
<thead>
<tr>
<th>Premium</th>
<th>Standard</th>
</tr>
</thead>
<tbody>
<tr>
<td>High throughput</td>
<td>Variable throughput</td>
</tr>
<tr>
<td>Predictable performance</td>
<td>Variable latency</td>
</tr>
<tr>
<td>Fixed pricing</td>
<td>Pay as you go variable pricing</td>
</tr>
<tr>
<td>Ability to scale workload up and down</td>
<td>N/A</td>
</tr>
<tr>
<td>Message size up to 100 MB</td>
<td>Message size up to 256 KB</td>
</tr>
</tbody>
</table><h2 id="advanced-features">Advanced features</h2>
<p>Service Bus includes advanced features that enable you to solve more complex messaging problems. The following table describes several of these features.</p>

<table>
<thead>
<tr>
<th>Feature</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Message sessions</td>
<td>To create a first-in, first-out (FIFO) guarantee in Service Bus, use sessions. Message sessions enable exclusive, ordered handling of unbounded sequences of related messages.</td>
</tr>
<tr>
<td>Autoforwarding</td>
<td>The autoforwarding feature chains a queue or subscription to another queue or topic that is in the same namespace.</td>
</tr>
<tr>
<td>Dead-letter queue</td>
<td>Service Bus supports a dead-letter queue (DLQ). A DLQ holds messages that can’t be delivered to any receiver. Service Bus lets you remove messages from the DLQ and inspect them.</td>
</tr>
<tr>
<td>Scheduled delivery</td>
<td>You can submit message</td>
</tr>
</tbody>
</table>
    </div>
  </div>
</body>

</html>
